<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 9.3.2 (459663)"/><meta name="author" content="zhoushuyu215@163.com"/><meta name="created" content="2020-04-03 06:44:41 +0000"/><meta name="source" content="desktop.mac"/><meta name="updated" content="2020-04-03 06:55:21 +0000"/><title>第二次作业文档</title></head><body><div><br/></div><div>1、新建app users</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>manage.py@mac_on_devops &gt; startapp users</div><div>bash -cl "/Users/zhoushuyu/workspaces/devops1/bin/python3 /Applications/PyCharm.app/Contents/plugins/python/helpers/pycharm/django_manage.py startapp users /Users/zhoushuyu/马哥Python面授班/projects/mac_on_devops"</div><div>Tracking file by folder pattern:  migrations</div><div><div><br/></div><div><br/></div></div><div>Following files were affected </div><div> /Users/zhoushuyu/马哥Python面授班/projects/mac_on_devops/users/migrations/__init__.py</div><div>Process finished with exit code 0</div></div><div><br/></div><div>2、注册新建的app，修改settings.py，在INSTALLED_APPS列表中新增'users.apps.UsersConfig'</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>INSTALLED_APPS = [</div><div>    ,,,</div><div>    'users.apps.UsersConfig'</div><div>]</div></div><div><br/></div><div>3、创建模型</div><div>在/Users/zhoushuyu/马哥Python面授班/projects/mac_on_devops/users/models.py中新增</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>from django.db import models</div><div><div><br/></div></div><div># Create your models here.</div><div>class users(models.Model):</div><div>    SEX = (</div><div>        (0,'男'),</div><div>        (1,'女')</div><div>    )</div><div>    username = models.CharField('用户名',max_length=20)</div><div>    sex = models.IntegerField('性别',choices=SEX,default=0)</div><div>    password = models.CharField('密码', max_length=32)</div><div><div><br/></div></div><div>    def __str__(self):</div><div>        return self.username</div></div><div><br/></div><div>4、生成数据表，落库</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>manage.py@mac_on_devops &gt; makemigrations users</div><div>bash -cl "/Users/zhoushuyu/workspaces/devops1/bin/python3 /Applications/PyCharm.app/Contents/plugins/python/helpers/pycharm/django_manage.py makemigrations users /Users/zhoushuyu/马哥Python面授班/projects/mac_on_devops"</div><div>Tracking file by folder pattern:  migrations</div><div>Migrations for 'users':</div><div>  users/migrations/0001_initial.py</div><div>    - Create model users</div><div><div><br/></div><div><br/></div></div><div>Following files were affected </div><div> /Users/zhoushuyu/马哥Python面授班/projects/mac_on_devops/users/migrations/0001_initial.py</div><div>Process finished with exit code 0</div><div>manage.py@mac_on_devops &gt; migrate users</div><div>bash -cl "/Users/zhoushuyu/workspaces/devops1/bin/python3 /Applications/PyCharm.app/Contents/plugins/python/helpers/pycharm/django_manage.py migrate users /Users/zhoushuyu/马哥Python面授班/projects/mac_on_devops"</div><div>Tracking file by folder pattern:  migrations</div><div>Operations to perform:</div><div>  Apply all migrations: users</div><div>Running migrations:</div><div>  Applying users.0001_initial... OK</div><div><div><br/></div><div><br/></div></div><div>Process finished with exit code 0</div></div><div>在数据库中的表名是 users_users</div><div><br/></div><div>5、创建模板</div><div>主模板base.html</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>&lt;!DOCTYPE html&gt;</div><div>&lt;html lang="en"&gt;</div><div>&lt;head&gt;</div><div>    &lt;meta charset="UTF-8"&gt;</div><div>    &lt;title&gt;自动化运维平台&lt;/title&gt;</div><div>&lt;/head&gt;</div><div>&lt;body&gt;</div><div>&lt;!--页面的header --&gt;</div><div>{% block title %}</div><div>    &lt;p&gt;用户列表&lt;/p&gt;</div><div>{% endblock %}</div><div><div><br/></div></div><div>{% block content %}</div><div>{% endblock %}</div><div><div><br/></div></div><div>&lt;!--页面的footer--&gt;</div><div>{% block footer %}</div><div>    &lt;p style="background-color: red"&gt;版权所有：马哥教育&lt;/p&gt;</div><div>{% endblock %}</div><div>&lt;/body&gt;</div><div>&lt;/html&gt;</div></div><div><br/></div><div>用户列表模板userlist1.jtml</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>{% extends 'base.html' %}</div><div>{% block title %}</div><div>    &lt;p style="background-color: aqua"&gt;用户的列表&lt;/p&gt;</div><div>{% endblock %}</div><div><div><br/></div><div><br/></div></div><div>{% block content %}</div><div>    &lt;table border="1"&gt;</div><div>    &lt;thead&gt;</div><div>    &lt;tr&gt;</div><div>        &lt;th&gt;用户名&lt;/th&gt;</div><div>        &lt;th&gt;性别&lt;/th&gt;</div><div>        &lt;th&gt;密码&lt;/th&gt;</div><div>        &lt;th&gt;操作&lt;/th&gt;</div><div>    &lt;/tr&gt;</div><div>    &lt;/thead&gt;</div><div>    &lt;tbody&gt;</div><div>    {% for user in all_users %}</div><div>        &lt;tr&gt;</div><div>            &lt;th&gt;{{ user.username }}&lt;/th&gt;</div><div>            &lt;th&gt;{{ user.get_sex_display }}&lt;/th&gt;</div><div>            &lt;th&gt;{{ user.password }}&lt;/th&gt;</div><div>            &lt;th&gt;&lt;a href="/users/edit/?user_id={{ user.pk }}"&gt;编辑&lt;/a&gt; &lt;a href="/users/del/{{ user.pk }}"&gt;删除&lt;/a&gt;&lt;/th&gt;</div><div>        &lt;/tr&gt;</div><div>    {% endfor %}</div><div>    &lt;/tbody&gt;</div><div>    &lt;/table&gt;</div><div>    &lt;a href="/users/add/"&gt;&lt;button&gt;添加&lt;/button&gt;&lt;/a&gt;</div><div>{% endblock %}</div></div><div><br/></div><div>用户添加模板useradd.html</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>{% extends 'base.html' %}</div><div>{% block title %}</div><div>    &lt;p style="background-color: aqua"&gt;用户添加页面&lt;/p&gt;</div><div>{% endblock %}</div><div><div><br/></div></div><div>{% block content %}</div><div>    &lt;form action="." method="post"&gt;</div><div>    &lt;input type="text" name="username" placeholder="请输入用户名"&gt;</div><div>    &lt;input type="text" name="sex" placeholder="请输入性别"&gt;</div><div>    &lt;input type="text" name="password" placeholder="请输入密码"&gt;</div><div>    &lt;input type="submit" value="提交"&gt;</div><div>    &lt;/form&gt;</div><div>{% endblock %}</div></div><div><br/></div><div>用户编辑模板useredit.html</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>{% extends 'base.html' %}</div><div>{% block title %}</div><div>    &lt;p style="background-color: aqua"&gt;用户修改&lt;/p&gt;</div><div>{% endblock %}</div><div><div><br/></div></div><div>{% block content %}</div><div>    &lt;form  method="post"&gt;</div><div>        &lt;input type="text" name="username" value="{{ res.username }}"&gt;</div><div>        &lt;input type="text" name="sex" value="{{ res.get_sex_display }}"&gt;</div><div>        &lt;input type="text" name="password" value="{{ res.password }}"&gt;</div><div>        &lt;input type="hidden" name="id" value="{{ res.id }}"&gt;</div><div>        &lt;input type="submit" value="提交"&gt;</div><div>    &lt;/form&gt;</div><div>{% endblock %}</div></div><div><br/></div><div>6、在users app下创建urls.py</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>from django.urls import path, re_path</div><div>from . import views</div><div><div><br/></div></div><div>urlpatterns = [</div><div>    path('list/', views.UserList),</div><div>    path('add/', views.UserAdd),</div><div>    path('edit/', views.UserEdit),</div><div>    #path('del/', views.UserDel),</div><div>    re_path('del/([1-9]\d*)', views.UserDel), #位置传参</div><div>]</div></div><div><br/></div><div>在主urls.py中添加</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>from django.contrib import admin</div><div>from django.urls import path, include</div><div>from hello import views</div><div><div><br/></div></div><div>urlpatterns = [</div><div>    path('admin/', admin.site.urls),</div><div>    #path('hello/', views.index), #使用hello app中的views.py模块中的index函数来处理hello这个请求。</div><div><div><br/></div></div><div>    path('hello/', include('hello.urls'), name='hello'),</div><div>    <font style="color: rgb(255, 124, 107); --inversion-type-color: simple;">path('users/', include('users.urls'), name='users'),</font></div><div>]</div></div><div><br/></div><div><br/></div><div>7、在users app下的views.py中定义处理逻辑</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>from django.shortcuts import render, HttpResponse, HttpResponseRedirect</div><div>from .models import users</div><div><div><br/></div><div><br/></div></div><div># Create your views here.</div><div>def UserList(request):</div><div>    all_users = users.objects.all</div><div>    print(all_users)</div><div>    return render(request,'userlist1.html',{</div><div>        'all_users': all_users,</div><div>    })</div><div><div><br/></div><div><br/></div></div><div>def UserAdd(request):</div><div>    if request.method == 'POST':</div><div>        username = request.POST['username']</div><div>        sex = request.POST['sex']</div><div>        password = request.POST['password']</div><div>        if sex == '男':</div><div>            sex = 0</div><div>        if sex == '女':</div><div>            sex = 1</div><div>        # print(username, sex, password)</div><div>        data = {'username':username, 'sex':sex, 'password':password}</div><div>        users.objects.create(**data)</div><div>    return render(request,'useradd.html')</div><div>    #return HttpResponseRedirect('/users/list/')</div><div><div><br/></div><div><br/></div></div><div>def UserEdit(request):</div><div>    if request.method == 'GET':</div><div>        #print(request.GET, request.GET.get('user_id'))</div><div>        pk = request.GET.get('user_id')</div><div>        res = users.objects.get(id=pk)</div><div>        print(res)</div><div>        print(res.username, res.password, res.sex)</div><div>        return render(request, 'useredit.html',{</div><div>            'res': res,</div><div>        })</div><div>    if request.method == 'POST':</div><div>        data = request.POST #&lt;QueryDict: {'username': ['user2'], 'sex': ['女'], 'password': ['P@ssw0rd'], 'id': ['1']}&gt;</div><div>        sex = 0</div><div>        if data['sex'] == '女':</div><div>            sex = 1</div><div>        if data['sex'] == '男':</div><div>            sex = 0</div><div>        users.objects.filter(id=data['id']).update(username=data['username'],sex=sex,password=data['password'])</div><div>        #return render(request, 'useredit.html')</div><div>        #return HttpResponse('{"status":"success"}', content_type='application/json')</div><div>        return HttpResponseRedirect('/users/list/')</div><div><div><br/></div><div><br/></div></div><div>def UserDel(request, *args, **kwargs):</div><div>    # print(request) &lt;WSGIRequest: GET '/users/del/1'&gt;</div><div>    #得到前端传递过来的逐渐ID</div><div>    pk = args[0]</div><div>    print(pk)</div><div>    u = users.objects.filter(id=pk).delete()</div><div>    #return HttpResponse('{"status":"success"}', content_type='application/json')</div><div>    return HttpResponseRedirect('/users/list/')</div></div><div><br/></div><div><br/></div><div>用户列表页面截图</div><div><img src="%E7%AC%AC%E4%BA%8C%E6%AC%A1%E4%BD%9C%E4%B8%9A%E6%96%87%E6%A1%A3.resources/4DFB72FD-2504-4713-BE0D-C3BA60B5CF1F.png" height="228" width="474"/></div><div><br/></div><div>用户添加页面截图</div><div><img src="%E7%AC%AC%E4%BA%8C%E6%AC%A1%E4%BD%9C%E4%B8%9A%E6%96%87%E6%A1%A3.resources/F793D10D-96F0-496D-B1A6-9F7AFA164154.png" height="183" width="643"/></div><div><br/></div><div>用户编辑页面截图</div><div><img src="%E7%AC%AC%E4%BA%8C%E6%AC%A1%E4%BD%9C%E4%B8%9A%E6%96%87%E6%A1%A3.resources/FF80D248-7784-4A49-9B73-38825EE4DFCA.png" height="171" width="541"/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></body></html>